# MC Marketplace API

![FastAPI](https://img.shields.io/badge/FastAPI-0.68.1-blue)
![Python](https://img.shields.io/badge/Python-3.9.7-green)
![Redis](https://img.shields.io/badge/Redis-6.2.5-red)
![Docker](https://img.shields.io/badge/Docker-20.10.8-blue)

This is a Python microservice example that provides a RESTful API for managing products in a marketplace. The API is built using the FastAPI framework and uses Redis as a data store and event broker.

## Getting Started

To get started with this project, you'll need to have Python 3.9 or later installed on your system. You'll also need to install the project dependencies using pip:

```
pip install -r requirements.txt
```

Once you have the dependencies installed, you can start the API server by running the following command:

```
python main.py
```

This will start the API server on `http://0.0.0.0:8080`.


## Environment Variables

The following environment variables can be used to configure the application:

- `DEBUG`: Set to `1` to enable debug mode. Defaults to `0`.
- `CORS_ALLOWED_METHODS`: A comma-separated list of HTTP methods that are allowed for CORS requests. Defaults to `"*"`.
- `CORS_ALLOWED_HEADERS`: A comma-separated list of HTTP headers that are allowed for CORS requests. Defaults to `"*"`.
- `CORS_ALLOWED_HOSTS`: A comma-separated list of hosts that are allowed for CORS requests. Defaults to an empty string.
- `REDIS_HOST`: The hostname or IP address of the Redis server. Defaults to `"redis"`.
- `REDIS_PASSWORD`: The password to use when connecting to the Redis server. Defaults to an empty string.
- `REDIS_PORT`: The port number to use when connecting to the Redis server. Defaults to `6379`.
- `BASE_PAYMENTS_API`: The base URL of the payments microservice API. Defaults to `"http://payments_web:9090"`.

You can set these environment variables using a `.env` file in the root directory of the project. The `.env` file should have the following format:

```properties
DEBUG=1
CORS_ALLOWED_METHODS="*"
CORS_ALLOWED_HEADERS="*"
CORS_ALLOWED_HOSTS=""
REDIS_HOST="redis"
REDIS_PASSWORD=""
REDIS_PORT=6379
BASE_PAYMENTS_API="http://payments_web:9090"
```

Note that the `REDIS_HOST` environment variable is set to `"redis"` by default, which assumes that you are using Docker Compose to run the application. If you are running the application outside of Docker Compose, you may need to set this variable to the hostname or IP address of your Redis server.

## API Endpoints

The following API endpoints are available:

### `GET /products`

Retrieves a list of all products in the marketplace.

#### Query Parameters

- `only_ids` (optional): If set to `true`, only the IDs of the products will be returned.

#### Response

Returns a JSON object with a `results` key that contains a list of products. Each product is represented as a JSON object with the following keys:

- `id`: The ID of the product.
- `name`: The name of the product.
- `description`: The description of the product.
- `price`: The price of the product.
- `quantity`: The quantity of the product.

### `POST /products`

Creates a new product in the marketplace.

#### Request Body

The request body should be a JSON object that represents the new product. The object should have the following keys:

- `name`: The name of the product.
- `description`: The description of the product.
- `price`: The price of the product.
- `quantity`: The quantity of the product.

#### Response

Returns a JSON object that represents the newly created product. The object has the same keys as the request body.

### `GET /products/{product_id}/details`

Retrieves the details of a specific product.

#### Path Parameters

- `product_id`: The ID of the product to retrieve.

#### Response

Returns a JSON object that represents the product. The object has the same keys as the request body for the `POST /products` endpoint.

### `DELETE /products/{product_id}`

Deletes a specific product.

#### Path Parameters

- `product_id`: The ID of the product to delete.

#### Response

Returns a 204 No Content response if the product was successfully deleted.

### `POST /products/{product_id}/buy`

Creates a new order for a specific product.

#### Request Body

The request body should be a JSON object that represents the order request. The object should have the following keys:

- `product_id`: The ID of the product to order.
- `quantity`: The quantity of the product to order.

#### Response

Returns a JSON object with a `message` key that indicates the order was created successfully.

## Autogenerated Docs

The API documentation is autogenerated and can be accessed by visiting `http://0.0.0.0:8080/docs` or `http://0.0.0.0:8080/redoc` in your web browser (if you are in DEBUG mode). The documentation provides detailed information about each endpoint, including the request and response schemas, query parameters, and example requests and responses.